// COPYRIGHT (C) HARRY CLARK 2025
// HITACHI SUPERH INSTRUCTION DECODER

// THIS FILE PERTAINS TOWARDS THE MODULARISATION AND LAYOUT OF THE INSTRUCTIONS
// IDENTIFIERS, THEIR RESPECTIVE CHARACTERISTICS, THE CONCATENATION OF TYPES
// AND HELPER FUNCTIONS - ALL PERTAINING TOWARDS THE INSTRUCTIONS OF THE SCU DSP 

// NESTED INCLUDES

#include "tables/tables.h"
#include "instructions/instructionDSP.h"

// INITIALISE THE BASIS FOR THE PROVIDED INSTRUCTION
// ACCESS THE WORD ENCOMPASSING THE INSTRUCTION AND IT'S RESPECTIVE ADDRESS
void CATH_DSP_INSTRUCTION_INIT(SH_DSP_INSTRUCTION* INSTR, U32 WORD, U32 ADDRESS)
{
    INSTR->WORD = WORD;
    INSTR->DESCRIPTOR = &DSP_DESCRIPTORS[INSTR->INSTR_ID];
    INSTR->INSTR_ID = CATH_INSTR_ID_TYPE_INVALID;
    INSTR->CATEGORY = CATH_INSTRCAT_DSP;
    INSTR->PC = ADDRESS;
}

// ACCCESES ALL OF THE AVAILABLE SLOT SOURCES FROM THE DSP
// THIS IS DONE THROUGH ACCESSING THE BUS SOURCE AND DEFINING
// THEIR RESPECTIVE DESCRIPTOR VALUE WITHIN THIS TABLE
void CATH_DSP_BUILD_SLOT_TABLE(const SH_DSP_DESCRIPTOR* DESC)
{
    CATH_DSP_SLOT_TABLE[0].SOURCE = DESC->X_BUS_SRC;
    CATH_DSP_SLOT_TABLE[0].DEST_NAME = "X";
    CATH_DSP_SLOT_TABLE[0].IS_ACTIVE = DESC->X_BUS;
    CATH_DSP_SLOT_TABLE[0].IS_ALU = DESC->IS_ALU_OP;

    CATH_DSP_SLOT_TABLE[1].SOURCE = DESC->D_BUS_SRC;
    CATH_DSP_SLOT_TABLE[1].DEST_NAME = "P";
    CATH_DSP_SLOT_TABLE[1].IS_ACTIVE = DESC->D_BUS;
    CATH_DSP_SLOT_TABLE[1].IS_ALU = DESC->IS_ALU_OP;

    CATH_DSP_SLOT_TABLE[2].SOURCE = DESC->Y_BUS_SRC;
    CATH_DSP_SLOT_TABLE[2].DEST_NAME = "Y";
    CATH_DSP_SLOT_TABLE[2].IS_ACTIVE = DESC->Y_BUS;
    CATH_DSP_SLOT_TABLE[2].IS_ALU = DESC->IS_ALU_OP;
}
